# 网络访问测试指南

## 问题诊断

Expo Web 配置为 tunnel 模式，但未显示 tunnel URL。让我提供多个测试方案。

## 方案 1：使用 Python 服务器测试（推荐）

### 访问地址
在手机浏览器访问：
```
http://9.129.115.216:6000/test-network.html
```

### 这个页面会做什么
1. 显示当前页面 URL（验证手机能否访问）
2. 提供按钮测试后端连接（9.129.115.216:9091）
3. 提供按钮测试前端连接（9.129.115.216:5000）

### 测试步骤
1. 访问上述地址
2. 点击"测试后端连接"按钮
3. 点击"测试前端连接"按钮
4. 查看结果

### 如果 Python 服务器能访问
说明网络是通的，问题可能在于：
- Expo 的具体配置
- 需要使用不同的 host 设置

### 如果 Python 服务器也无法访问
说明网络连接有问题，需要检查：
- 防火墙设置
- 网络配置
- IP 地址是否正确

## 方案 2：检查 Expo Tunnel

Expo 已经在 tunnel 模式运行，但需要获取 tunnel URL。

### 方法 1：查看 Expo Dev Tools
在电脑浏览器访问：
```
http://localhost:5000
```

通常在页面底部或右上角会显示 tunnel URL，格式类似：
```
https://xxxxx.ngrok-free.app
```

### 方法 2：查看日志
运行以下命令查看 tunnel URL：
```bash
curl -s http://localhost:5000 2>&1 | grep -i "tunnel"
```

如果找到 tunnel URL，手机直接访问该 URL 即可。

## 方案 3：使用 ngrok 手动创建隧道

如果 Expo tunnel 不工作，可以手动使用 ngrok。

### 步骤

1. 安装 ngrok（如果已安装可跳过）
```bash
npm install -g ngrok
```

2. 在新终端中运行 ngrok
```bash
ngrok http 5000
```

3. ngrok 会显示一个公网 URL，例如：
```
https://abcd1234.ngrok-free.app
```

4. 手机直接访问该 URL

## 方案 4：构建静态文件并使用 serve

如果以上都不行，可以构建静态文件。

### 步骤

1. 构建项目
```bash
cd /workspace/projects/client
npx expo export --platform web
```

2. 使用 serve 托管
```bash
cd dist
npx serve -l 6000 --host 0.0.0.0
```

3. 手机访问：http://9.129.115.216:6000

## 当前服务状态

- ✅ 前端服务 (Expo)：监听 :::5000 (tunnel 模式)
- ✅ 后端服务：监听 :::9091
- ✅ Python 测试服务器：监听 :::6000

## 测试命令

在电脑上运行以下命令测试服务是否可从外部访问：

```bash
# 测试 Python 服务器
curl -I http://9.129.115.216:6000/test-network.html

# 测试前端
curl -I http://9.129.115.216:5000

# 测试后端
curl http://9.129.115.216:9091/api/v1/health
```

## 下一步

请按顺序尝试以下操作：

1. **首先测试 Python 服务器**（最简单）
   - 手机访问：http://9.129.115.216:6000/test-network.html
   - 告诉我测试结果

2. **如果 Python 服务器能访问**
   - 说明网络是通的
   - 我们尝试其他方法来访问 Expo

3. **如果 Python 服务器也不能访问**
   - 说明网络连接有问题
   - 需要检查网络配置

## 常见问题

### Q: 为什么用 Python 服务器？
A: Python 服务器更简单，不受 Expo 配置影响，可以帮助我们诊断是网络问题还是 Expo 配置问题。

### Q: IP 地址会变吗？
A: 可能会。如果 IP 变化，需要重新获取并更新所有配置。

### Q: tunnel URL 是什么？
A: tunnel 是一个公网 URL，通过 ngrok 等工具创建，可以从任何地方访问（无需同一局域网）。

## 联系信息

如果以上方法都不行，请提供：
1. Python 服务器测试结果
2. Expo tunnel URL（如果能获取）
3. 防火墙状态
4. 网络环境（家庭/公司/学校）
