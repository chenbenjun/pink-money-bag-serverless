<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®°è´¦åº”ç”¨ - åŠŸèƒ½æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 14px;
            color: #0d47a1;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .button {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 10px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.secondary {
            background: #6c757d;
        }

        .button.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .log {
            background: #212529;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .result {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 20px;
            }

            .section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± è®°è´¦åº”ç”¨ - åŠŸèƒ½æµ‹è¯•</h1>
        <p class="subtitle">æ‰‹æœºç«¯éªŒè¯é¡µé¢</p>

        <div id="status" class="status hidden"></div>

        <!-- 1. åç«¯è¿æ¥æµ‹è¯• -->
        <div class="section">
            <div class="section-title">ğŸ”— 1. åç«¯è¿æ¥æµ‹è¯•</div>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">æµ‹è¯•æ‰‹æœºèƒ½å¦è¿æ¥åˆ°åç«¯æœåŠ¡å™¨</p>
            <button class="button" onclick="testBackendConnection()">æµ‹è¯•åç«¯è¿æ¥</button>
            <div id="backendResult" class="result hidden"></div>
            <div id="backendLog" class="log hidden"></div>
        </div>

        <!-- 2. äº¤æ˜“è¯¦æƒ…é¡µæµ‹è¯• -->
        <div class="section">
            <div class="section-title">ğŸ’° 2. äº¤æ˜“è¯¦æƒ…é¡µæµ‹è¯•</div>
            <div class="info">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·³è½¬åˆ°äº¤æ˜“è¯¦æƒ…é¡µé¢ï¼ŒæŸ¥çœ‹æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½äº¤æ˜“æ•°æ®
            </div>
            <div class="input-group">
                <label>äº¤æ˜“IDï¼ˆå·²é¢„å¡«æµ‹è¯•æ•°æ®ï¼‰:</label>
                <input type="text" id="transactionId" value="999b6f7a-99bd-45bd-9eaf-58376838cc58" readonly>
            </div>
            <button class="button success" onclick="openTransactionDetail()">æ‰“å¼€äº¤æ˜“è¯¦æƒ…é¡µ</button>
            <div id="detailResult" class="result hidden"></div>
        </div>

        <!-- 3. æ„è§åé¦ˆæµ‹è¯• -->
        <div class="section">
            <div class="section-title">ğŸ“ 3. æ„è§åé¦ˆæµ‹è¯•</div>
            <div class="info">
                å¡«å†™åé¦ˆä¿¡æ¯å¹¶æäº¤ï¼Œæµ‹è¯•æ„è§åé¦ˆåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
            </div>
            <form id="feedbackForm">
                <div class="input-group">
                    <label for="feedbackType">åé¦ˆç±»å‹:</label>
                    <select id="feedbackType" required>
                        <option value="bug">é—®é¢˜åé¦ˆ</option>
                        <option value="feature">åŠŸèƒ½å»ºè®®</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="feedbackContent">åé¦ˆå†…å®¹:</label>
                    <textarea id="feedbackContent" placeholder="è¯·è¾“å…¥æ‚¨çš„åé¦ˆå†…å®¹..." required></textarea>
                </div>
                <button type="submit" class="button">æäº¤åé¦ˆ</button>
            </form>
            <div id="feedbackResult" class="result hidden"></div>
            <div id="feedbackLog" class="log hidden"></div>
        </div>

        <!-- 4. æµ‹è¯•æ€»ç»“ -->
        <div class="section">
            <div class="section-title">âœ… 4. æµ‹è¯•æ€»ç»“</div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="button secondary" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://115.191.1.197:9091/api/v1';

        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºçŠ¶æ€
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.classList.remove('hidden');
        }

        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæ—¥å¿—
        function showLog(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
            element.classList.remove('hidden');
            element.scrollTop = element.scrollHeight;
        }

        // å·¥å…·å‡½æ•°ï¼šæ¸…é™¤æ—¥å¿—
        function clearLog(elementId) {
            const element = document.getElementById(elementId);
            element.textContent = '';
        }

        // 1. æµ‹è¯•åç«¯è¿æ¥
        async function testBackendConnection() {
            const logElement = 'backendLog';
            clearLog(logElement);

            showLog(logElement, 'å¼€å§‹æµ‹è¯•åç«¯è¿æ¥...');
            showLog(logElement, `APIåœ°å€: ${API_BASE_URL}`);

            try {
                showLog(logElement, 'å‘é€è¯·æ±‚åˆ° /health ç«¯ç‚¹...');
                const response = await fetch(`${API_BASE_URL}/health`);

                showLog(logElement, `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                showLog(logElement, `å“åº”ç±»å‹: ${response.headers.get('content-type')}`);

                const data = await response.json();
                showLog(logElement, `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`);

                if (response.ok) {
                    showStatus('backendResult', 'âœ… åç«¯è¿æ¥æˆåŠŸï¼æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ã€‚', 'success');
                } else {
                    showStatus('backendResult', `âŒ åç«¯å“åº”å¼‚å¸¸: ${response.status}`, 'error');
                }
            } catch (error) {
                showLog(logElement, `é”™è¯¯è¯¦æƒ…: ${error.message}`);
                showStatus('backendResult', 'âŒ åç«¯è¿æ¥å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®ã€‚', 'error');
            }
        }

        // 2. æ‰“å¼€äº¤æ˜“è¯¦æƒ…é¡µ
        function openTransactionDetail() {
            const transactionId = document.getElementById('transactionId').value;
            const url = `http://115.191.1.197:3000/transaction-detail-simple.html?id=${transactionId}`;

            showStatus('detailResult', 'ğŸ“± æ­£åœ¨æ‰“å¼€äº¤æ˜“è¯¦æƒ…é¡µ...', 'success');
            window.open(url, '_blank');

            // å»¶è¿Ÿæ˜¾ç¤ºæç¤º
            setTimeout(() => {
                showStatus('detailResult', 'âœ… å·²æ‰“å¼€æ–°çª—å£ï¼Œè¯·æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…é¡µæ˜¯å¦èƒ½æ­£å¸¸åŠ è½½', 'success');
            }, 1000);
        }

        // 3. æäº¤åé¦ˆ
        async function submitFeedback(event) {
            event.preventDefault();

            const logElement = 'feedbackLog';
            clearLog(logElement);

            const feedbackType = document.getElementById('feedbackType').value;
            const feedbackContent = document.getElementById('feedbackContent').value;

            showLog(logElement, 'å¼€å§‹æäº¤åé¦ˆ...');
            showLog(logElement, `åé¦ˆç±»å‹: ${feedbackType}`);
            showLog(logElement, `åé¦ˆå†…å®¹: ${feedbackContent.substring(0, 50)}...`);

            try {
                showLog(logElement, `å‘é€è¯·æ±‚åˆ° ${API_BASE_URL}/feedback...`);

                const response = await fetch(`${API_BASE_URL}/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: feedbackType,
                        content: feedbackContent,
                        user_id: '4b443ebf-a9c9-44bc-bbfb-733330cc9f9f' // æµ‹è¯•ç”¨æˆ·ID
                    })
                });

                showLog(logElement, `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);

                const data = await response.json();
                showLog(logElement, `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`);

                if (response.ok) {
                    showStatus('feedbackResult', 'âœ… åé¦ˆæäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚', 'success');
                    document.getElementById('feedbackForm').reset();
                } else {
                    showStatus('feedbackResult', `âŒ åé¦ˆæäº¤å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                }
            } catch (error) {
                showLog(logElement, `é”™è¯¯è¯¦æƒ…: ${error.message}`);
                showStatus('feedbackResult', 'âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥ã€‚', 'error');
            }
        }

        // ç»‘å®šåé¦ˆè¡¨å•æäº¤
        document.getElementById('feedbackForm').addEventListener('submit', submitFeedback);

        // 4. è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            alert('å°†ä¾æ¬¡è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œè¯·è€å¿ƒç­‰å¾…...');

            // æµ‹è¯•1ï¼šåç«¯è¿æ¥
            await testBackendConnection();
            await sleep(2000);

            // æµ‹è¯•3ï¼šæ¨¡æ‹Ÿæäº¤åé¦ˆ
            showLog('feedbackLog', 'è¿è¡Œè‡ªåŠ¨æµ‹è¯•ï¼šæäº¤æµ‹è¯•åé¦ˆ...');
            document.getElementById('feedbackType').value = 'other';
            document.getElementById('feedbackContent').value = 'è¿™æ˜¯è‡ªåŠ¨æµ‹è¯•åé¦ˆ';

            const submitEvent = new Event('submit');
            document.getElementById('feedbackForm').dispatchEvent(submitEvent);

            alert('æµ‹è¯•å®Œæˆï¼è¯·æŸ¥çœ‹å„ä¸ªéƒ¨åˆ†çš„æµ‹è¯•ç»“æœã€‚');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•åç«¯è¿æ¥
        window.addEventListener('load', () => {
            console.log('é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡æµ‹è¯•...');
            // è‡ªåŠ¨è¿è¡Œåç«¯è¿æ¥æµ‹è¯•
            setTimeout(testBackendConnection, 500);
        });
    </script>
</body>
</html>
